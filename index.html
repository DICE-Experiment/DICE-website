<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DICE ‚Äî Normas & honestidad en 34 pa√≠ses</title>
  <meta name="description" content="DICE: experimento multicountry en aula sobre normas sociales, honestidad y cumplimiento; protocolo com√∫n, datos abiertos y pre‚Äëregistros." />
  <link rel="canonical" href="https://dice-experiment.github.io/DICE-website/" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0b1225" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="DICE ‚Äî Normas & honestidad en 34 pa√≠ses" />
  <meta property="og:description" content="Experimento en aula coordinado en 34 pa√≠ses con protocolo com√∫n, preregistros y datos abiertos." />
  <meta property="og:image" content="https://dice-experiment.github.io/DICE-website/og.png" />
  <meta property="og:url" content="https://dice-experiment.github.io/DICE-website/" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Project",
    "name":"DICE ‚Äî Normas y honestidad",
    "url":"https://dice-experiment.github.io/DICE-website/",
    "description":"Experimento en aula coordinado en 34 pa√≠ses para estudiar normas sociales y honestidad.",
    "creator": {"@type":"Organization","name":"DICE Collaboration"}
  }
  </script>

  <!-- Fonts (with preconnect and swap) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <style>
    :root{
      --bg:#0b1225; --surface:#0f172a; --card:#0e162d; --muted:#94a3b8; --text:#e5e7eb;
      --line:#1f2937; --brand:#60a5fa; --accent:#34d399; --warn:#fbbf24; --chip:#111827;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{margin:0; padding:0; background:var(--bg); color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--brand); text-decoration:none}
    a:hover{text-decoration:underline}
    a:focus-visible, button:focus-visible{outline:2px solid var(--brand); outline-offset:2px}
    .skip{position:absolute; left:-9999px}
    .skip:focus{left:12px; top:12px; background:#000; color:#fff; padding:8px 10px; border-radius:8px; z-index:50}
    img{max-width:100%; height:auto}
    .container{max-width:1200px; margin:0 auto; padding:0 20px}
    .nav{position:sticky; top:0; z-index:20; background:rgba(10,15,30,.75); backdrop-filter: blur(8px); border-bottom:1px solid var(--line)}
    .nav-inner{display:flex; align-items:center; justify-content:space-between; padding:14px 0}
    .brand{display:flex; align-items:center; gap:12px; font-weight:800}
    .logo{font-size:32px; line-height:1; display:flex; align-items:center; justify-content:center;}
    .tabs{display:flex; gap:10px; flex-wrap:wrap}
    .tabs a{padding:8px 12px; background:var(--chip); border:1px solid var(--line); border-radius:10px; font-size:14px}
    .tabs a:hover{border-color:var(--brand); transform:translateY(-1px)}
    .hero{padding:80px 0 40px; position:relative; overflow:hidden}
    .glow{position:absolute; inset:-30% -10% auto -10%; height:420px;
          background:radial-gradient(550px 300px at 20% 20%, rgba(96,165,250,.2), transparent 60%),
                     radial-gradient(500px 260px at 80% 30%, rgba(251,191,36,.12), transparent 60%),
                     radial-gradient(600px 300px at 50% 100%, rgba(52,211,153,.12), transparent 60%); filter:blur(40px); z-index:-1}
    h1{font-size:42px; margin:10px 0 8px}
    .sub{color:var(--muted); font-size:18px; max-width:900px}
    .chips{display:flex; gap:12px; flex-wrap:wrap; margin-top:20px}
    .chip{background:var(--chip); border:1px solid var(--line); padding:10px 16px; border-radius:999px; font-size:15px; font-weight:500; transition:all .2s}
    a.chip{color:var(--text); text-decoration:none}
    a.chip:hover{border-color:var(--brand); transform:translateY(-2px); box-shadow:0 4px 12px rgba(96,165,250,.3)}
    section{padding:50px 0; border-top:1px solid var(--line)}
    h2{font-size:28px; margin:0 0 16px}
    h3{margin-top:0}
    .two-col{display:grid; grid-template-columns:1.15fr .85fr; gap:22px}
    .two-col.equal{grid-template-columns:1fr 1fr}
    .card{background:var(--card); border:1px solid var(--line); border-radius:16px; padding:22px; box-shadow:var(--shadow)}
    a.card-link{text-decoration:none; color:var(--text); display:block; transition:all .2s; cursor:pointer}
    a.card-link:hover{transform:translateY(-2px); border-color:var(--brand); box-shadow:0 8px 24px rgba(96,165,250,.2)}
    .list{display:grid; gap:10px}
    .list .item{display:flex; gap:12px; align-items:flex-start; background:var(--surface); border:1px solid var(--line); padding:12px 14px; border-radius:12px}
    .bullet{width:8px; height:8px; border-radius:50%; background:var(--brand); margin-top:8px}
    .grid{display:grid; gap:16px}
    .cols-2{grid-template-columns:repeat(2,1fr)}
    .cols-3{grid-template-columns:repeat(3,1fr)}
    .cols-4{grid-template-columns:repeat(4,1fr)}
    @media (max-width:980px){ .two-col{grid-template-columns:1fr} .two-col.equal{grid-template-columns:1fr} .cols-3{grid-template-columns:repeat(2,1fr)} .cols-4{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:640px){ .cols-3,.cols-4{grid-template-columns:1fr} h1{font-size:34px} }
    .proj{background:var(--surface); border:1px solid var(--line); border-radius:16px; padding:18px}
    .proj h4{margin:0 0 6px}
    .tag{display:inline-block; padding:6px 10px; background:var(--chip); border:1px solid var(--line); border-radius:999px; font-size:12px; margin-right:6px}
    .gallery{display:grid; grid-template-columns:repeat(6,1fr); gap:8px}
    .gallery img{width:100%; height:120px; object-fit:cover; border-radius:10px; border:1px solid var(--line)}
    @media (max-width:980px){ .gallery{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:640px){ .gallery{grid-template-columns:repeat(2,1fr)} }
    footer{padding:40px 0; color:var(--muted)}
    .small{font-size:12px; color:var(--muted)}
    .btn{display:inline-block; padding:10px 14px; border-radius:10px; background:var(--brand); color:#04101f; font-weight:700; border:1px solid transparent}
    .btn.secondary{background:transparent; border:1px solid var(--brand); color:var(--brand)}
    .lang-btn{display:flex; gap:2px; padding:6px 8px; background:var(--chip); border:1px solid var(--line); border-radius:10px; cursor:pointer; font-size:13px; font-weight:600; transition:border-color .2s}
    .lang-btn:hover{border-color:var(--brand)}
    .lang-option{padding:4px 8px; border-radius:6px; color:var(--muted); transition:all .2s}
    .lang-option.active{background:var(--brand); color:#04101f}
    #map{width:100%; height:500px; border-radius:12px; overflow:hidden}
    .map-legend{display:flex; justify-content:center; margin-top:20px; gap:20px}
    .legend-item{display:flex; align-items:center; gap:8px}
    .legend-dot{width:12px; height:12px; border-radius:50%; background:var(--brand); border:2px solid var(--accent)}
    .leaflet-container{background:var(--surface); font-family:Inter,sans-serif}
    .leaflet-container a.leaflet-popup-close-button{color:var(--text)}
    .leaflet-popup-content-wrapper{background:var(--card); color:var(--text); border-radius:8px}
    .leaflet-popup-tip{background:var(--card)}
    .leaflet-tooltip.country-tooltip{background:var(--card); color:var(--text); border:2px solid var(--brand); border-radius:12px; padding:12px 14px; font-size:13px; box-shadow:0 8px 24px rgba(0,0,0,0.4); max-width:350px; line-height:1.4}
    .leaflet-tooltip.country-tooltip::before{border-top-color:var(--brand) !important}

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){ .tabs a:hover, a.chip:hover{transform:none} }

    /* Toast notifications */
    .toast{position:fixed; top:50%; left:50%; background:#10b981; color:#04101f; padding:12px 16px; border-radius:12px; box-shadow:var(--shadow); font-weight:700; z-index:1000; opacity:0; transform:translate(-50%, -12px); transition:opacity .2s, transform .2s}
    .toast.show{opacity:1; transform:translate(-50%, 0)}
  </style>
</head>
<body>
<a href="#main" class="skip">Saltar al contenido</a>

<!-- NAV -->
<div class="nav" role="navigation" aria-label="principal">
  <div class="container nav-inner">
    <div class="brand">
      <div class="logo" aria-hidden="true">üé≤</div>
      <div>DICE ‚Äî <span class="small" data-i18n="nav.subtitle">Experimento multicultural en aula</span></div>
    </div>
    <nav class="tabs">
      <a href="#implementacion" data-i18n-nav="implementation">Implementaci√≥n</a>
      <a href="#colaboradores" data-i18n-nav="collaborators">Colaboradores</a>
      <a href="#proyectos" data-i18n-nav="projects">Proyectos</a>
      <a href="#datos" data-i18n-nav="data">Datos</a>
      <a href="#cuestionario" data-i18n-nav="prereg">Pre‚Äëregistros</a>
      <a href="#fotos" data-i18n-nav="photos">Fotos</a>
      <button id="lang-toggle" class="lang-btn" aria-label="Change language">
        <span class="lang-option" data-lang="en">EN</span>
        <span class="lang-option active" data-lang="es">ES</span>
      </button>
    </nav>
  </div>
</div>

<!-- HERO -->
<header id="bienvenida" class="hero">
  <div class="glow" aria-hidden="true"></div>
  <div class="container">
    <h1 data-i18n="hero.title">Proyecto DICE</h1>
    <p class="sub" data-i18n="hero.subtitle">
      Un experimento en aula, coordinado y armonizado, realizado en <strong>34 pa√≠ses</strong> para estudiar normas sociales y honestidad.
      La base de datos com√∫n alimenta <strong>14 proyectos</strong> que analizan mecanismos complementarios (capital c√≠vico, confianza institucional, preferencias sociales y cumplimiento).
    </p>
    <div class="chips" aria-label="caracter√≠sticas">
      <a href="#paises" class="chip" data-i18n="hero.chip2">34 pa√≠ses</a>
      <a href="#proyectos" class="chip" data-i18n="hero.chip5">14 proyectos vinculados</a>
      <a href="#implementacion" class="chip" data-i18n="hero.chip3">Protocolo com√∫n</a>
      <a href="#datos" class="chip" data-i18n="hero.chip4">Materiales abiertos</a>
    </div>
  </div>
</header>

<main id="main">
  <!-- PA√çSES -->
  <section id="paises">
    <div class="container">
      <h2 data-i18n="countries.title">34 Pa√≠ses participantes</h2>
      <p class="sub" data-i18n="countries.subtitle">Red global de investigaci√≥n con representaci√≥n en 5 continentes.</p>
      <div class="card" style="margin-top:20px; background:var(--surface); padding:30px">
        <div id="map"></div>
        <div class="map-legend">
          <div class="legend-item">
            <span class="legend-dot"></span>
            <span class="small" data-i18n="countries.legend">Pa√≠ses participantes (34)</span>
          </div>
        </div>
        <p class="small" style="margin-top:16px; text-align:center" data-i18n="countries.note">
          Cobertura en Am√©rica, Europa, Asia, √Åfrica y Ocean√≠a
        </p>
      </div>
    </div>
  </section>

  <!-- IMPLEMENTACI√ìN -->
  <section id="implementacion">
    <div class="container two-col">
      <div class="card">
        <h2 data-i18n="implementation.title">Resumen de implementaci√≥n</h2>
        <div class="list">
          <div class="item"><div class="bullet" aria-hidden="true"></div><div data-i18n="implementation.item1"><strong>Dise√±o:</strong> Tarea del dado en aula con instrucciones armonizadas, supervisi√≥n y tiempos estandarizados.</div></div>
          <div class="item"><div class="bullet" aria-hidden="true"></div><div data-i18n="implementation.item2"><strong>Muestra:</strong> Clases universitarias; N objetivo por pa√≠s seg√∫n protocolo (sustituir con tus cifras).</div></div>
          <div class="item"><div class="bullet" aria-hidden="true"></div><div data-i18n="implementation.item3"><strong>Medidas clave:</strong> Reporte de resultados, proxies de honestidad, normas sociales, confianza, conductas c√≠vicas y demograf√≠a.</div></div>
          <div class="item"><div class="bullet" aria-hidden="true"></div><div data-i18n="implementation.item4"><strong>Calidad:</strong> Pre‚Äëregistro, checklist de proctor, marcas de tiempo y validaci√≥n centralizada.</div></div>
          <div class="item"><div class="bullet" aria-hidden="true"></div><div data-i18n="implementation.item5"><strong>Datos:</strong> Liberaciones por etapas (piloto ‚Üí v1.0 ‚Üí replicaci√≥n) con gu√≠a de licencia y citaci√≥n.</div></div>
        </div>
      </div>
      <aside class="card" aria-labelledby="accesos-rapidos">
        <h3 id="accesos-rapidos" data-i18n="implementation.quickLinks">Accesos r√°pidos</h3>
        <div class="list">
          <div class="item"><div class="bullet" aria-hidden="true"></div><div><a href="#cuestionario" data-i18n="implementation.link1">Vista previa del cuestionario</a></div></div>
          <div class="item"><div class="bullet" aria-hidden="true"></div><div><a href="#cuestionario" data-i18n="implementation.link2">Registro de pre‚Äëan√°lisis</a></div></div>
          <div class="item"><div class="bullet" aria-hidden="true"></div><div><a href="#proyectos" data-i18n="implementation.link3">Listado de proyectos</a></div></div>
          <div class="item"><div class="bullet" aria-hidden="true"></div><div><a href="#" data-i18n="implementation.link4">Paquete de replicaci√≥n (placeholder)</a></div></div>
        </div>
        <p class="small" style="margin-top:8px" data-i18n="implementation.note">Sustituye los <em>placeholders</em> por enlaces a OSF/AEA/Dataverse/GitHub.</p>
      </aside>
    </div>
  </section>

  <!-- COLABORADORES -->
  <section id="colaboradores">
    <div class="container">
      <h2 data-i18n="collaborators.title">Colaboradores</h2>
      <p class="sub" data-i18n="collaborators.subtitle">Red global de investigadores/as, docentes y asistentes. A√±ade logotipos, nombres, roles e instituciones.</p>
      <div class="grid cols-4" style="margin-top:16px">
        <div class="card">
          <h3 data-i18n="collaborators.card1.title">Coordinaci√≥n</h3>
          <p data-i18n="collaborators.card1.text">Investigador principal: <strong><a href="https://www.ub.edu/school-economics/researchers/exadaktylos-filippos/" target="_blank" style="color:inherit; text-decoration:none">Filippos Exadaktylos</a></strong> (ejemplo)</p>
          <p class="small" data-i18n="collaborators.card1.note">A√±ade co‚ÄëIPs, gesti√≥n de proyecto y contactos.</p>
        </div>
        <a href="countries.html" class="card card-link">
          <h3 data-i18n="collaborators.card2.title">Equipos por pa√≠s</h3>
          <p data-i18n="collaborators.card2.text">Una tarjeta por pa√≠s con instituci√≥n, PI(s), ciudad, nivel educativo y tama√±o muestral.</p>
          <p class="small" style="margin-top:12px; color:var(--brand)" data-i18n="collaborators.card2.viewall">‚Üí Ver todos los 34 pa√≠ses</p>
        </a>
        <div class="card">
          <h3 data-i18n="collaborators.card3.title">M√©todos & QA</h3>
          <p data-i18n="collaborators.card3.text">Autores del protocolo, arquitectura de encuesta y equipo de auditor√≠a de datos.</p>
          <span class="tag" data-i18n="collaborators.card3.tag1">Protocolo</span>
          <span class="tag" data-i18n="collaborators.card3.tag2">Encuesta</span>
          <span class="tag" data-i18n="collaborators.card3.tag3">Auditor√≠a</span>
        </div>
        <div class="card">
          <h3 data-i18n="collaborators.card4.title">Socios & financiadores</h3>
          <p data-i18n="collaborators.card4.text">Incluye n√∫meros de beca, patrocinadores y alianzas institucionales.</p>
          <span class="tag">Grant #</span>
          <span class="tag">Partner</span>
        </div>
      </div>
    </div>
  </section>

  <!-- PROYECTOS -->
  <section id="proyectos">
    <div class="container">
      <h2 data-i18n="projects.title">Proyectos (14)</h2>
      <p class="sub" data-i18n="projects.subtitle">Cada proyecto aprovecha una parte distinta del dataset com√∫n. A continuaci√≥n, res√∫menes breves y enlaces clave.</p>
      <div class="grid cols-3" style="margin-top:16px">
        <div class="proj"><h4 data-i18n="projects.p1.title">1. Normas sociales & reporte</h4><p class="small" data-i18n="projects.p1.desc">Relaci√≥n entre normas percibidas/metacreencias y conducta en la tarea del dado.</p><div><span class="tag" data-i18n="projects.tag.analysis">Plan de an√°lisis</span><span class="tag" data-i18n="projects.tag.materials">Materiales</span><span class="tag" data-i18n="projects.tag.code">C√≥digo</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p2.title">2. Capital c√≠vico & confianza</h4><p class="small" data-i18n="projects.p2.desc">Conductas c√≠vicas, confianza institucional y honestidad entre culturas.</p><div><span class="tag" data-i18n="projects.tag.prereg">Pre‚Äëreg</span><span class="tag" data-i18n="projects.tag.slides">Diapositivas</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p3.title">3. Cumplimiento & pol√≠tica</h4><p class="small" data-i18n="projects.p3.desc">Aceptaci√≥n de reglas y correlatos de cumplimiento.</p><div><span class="tag" data-i18n="projects.tag.design">Dise√±o</span><span class="tag" data-i18n="projects.tag.results">Resultados</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p4.title">4. Dimensiones culturales</h4><p class="small" data-i18n="projects.p4.desc">Individualismo, universalismo y seguimiento de normas.</p><div><span class="tag" data-i18n="projects.tag.prereg">Pre‚Äëreg</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p5.title">5. Instituciones & honestidad</h4><p class="small" data-i18n="projects.p5.desc">Calidad institucional e interacciones con proxies de honestidad.</p><div><span class="tag" data-i18n="projects.tag.code">C√≥digo</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p6.title">6. Desigualdad & justicia</h4><p class="small" data-i18n="projects.p6.desc">Preferencias distributivas y cumplimiento de reglas.</p><div><span class="tag" data-i18n="projects.tag.materials">Materiales</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p7.title">7. Educaci√≥n & cohortes</h4><p class="small" data-i18n="projects.p7.desc">Diferencias por edad y nivel educativo.</p><div><span class="tag" data-i18n="projects.tag.slides">Diapositivas</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p8.title">8. Urbano vs. regional</h4><p class="small" data-i18n="projects.p8.desc">Geograf√≠a, tipo de centro y normas.</p><div><span class="tag" data-i18n="projects.tag.prereg">Pre‚Äëreg</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p9.title">9. G√©nero & normas</h4><p class="small" data-i18n="projects.p9.desc">Expectativas de g√©nero y honestidad.</p><div><span class="tag" data-i18n="projects.tag.results">Resultados</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p10.title">10. Replicaci√≥n & m√©todos</h4><p class="small" data-i18n="projects.p10.desc">Potencia, identificaci√≥n y robustez entre pa√≠ses.</p><div><span class="tag" data-i18n="projects.tag.code">C√≥digo</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p11.title">11. Mensajes & creencias</h4><p class="small" data-i18n="projects.p11.desc">Tratamientos informativos y actualizaci√≥n de normas.</p><div><span class="tag" data-i18n="projects.tag.prereg">Pre‚Äëreg</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p12.title">12. Redes & spillovers</h4><p class="small" data-i18n="projects.p12.desc">Efectos de pares en el aula.</p><div><span class="tag" data-i18n="projects.tag.design">Dise√±o</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p13.title">13. √âtica & consentimiento</h4><p class="small" data-i18n="projects.p13.desc">Aprobaciones √©ticas y lenguaje de consentimiento.</p><div><span class="tag" data-i18n="projects.tag.materials">Materiales</span></div></div>
        <div class="proj"><h4 data-i18n="projects.p14.title">14. Curaci√≥n de datos</h4><p class="small" data-i18n="projects.p14.desc">Estandarizaci√≥n documental y versionado.</p><div><span class="tag" data-i18n="projects.tag.guide">Gu√≠a</span></div></div>
      </div>
    </div>
  </section>

  <!-- DATOS -->
  <section id="datos">
    <div class="container">
      <h2 data-i18n="data.title">Datos</h2>
      <p class="sub" data-i18n="data.subtitle">Accede a nuestros datos de muestra del experimento DICE. Datos completos disponibles tras publicaci√≥n.</p>
      <div class="grid cols-2" style="margin-top:16px">
        <div class="card">
          <h3 data-i18n="data.card1.title">Datos de muestra</h3>
          <p data-i18n="data.card1.desc">Dataset de ejemplo con 15 participantes de 5 pa√≠ses. Incluye resultados del dado, datos demogr√°ficos y puntuaciones de confianza.</p>
          <p class="small" style="margin-top:12px">
            <strong data-i18n="data.card1.format">Formato:</strong> CSV<br/>
            <strong data-i18n="data.card1.size">Tama√±o:</strong> ~1 KB<br/>
            <strong data-i18n="data.card1.updated">Actualizado:</strong> 2024-03-25
          </p>
          <p style="margin-top:16px">
            <a class="btn" href="data/general/sample-full-data.csv" download data-i18n="data.card1.btn">Descargar datos de muestra</a>
          </p>
        </div>
        <div class="card">
          <h3 data-i18n="data.card2.title">Estructura de datos</h3>
          <p data-i18n="data.card2.desc">El dataset incluye las siguientes variables:</p>
          <ul style="margin-top:8px">
            <li><code>country</code> ‚Äî <span data-i18n="data.card2.var1">Pa√≠s del participante</span></li>
            <li><code>participant_id</code> ‚Äî <span data-i18n="data.card2.var2">ID √∫nico</span></li>
            <li><code>dice_roll</code> ‚Äî <span data-i18n="data.card2.var3">Resultado real del dado</span></li>
            <li><code>reported_value</code> ‚Äî <span data-i18n="data.card2.var4">Valor reportado</span></li>
            <li><code>session_date</code> ‚Äî <span data-i18n="data.card2.var5">Fecha de sesi√≥n</span></li>
            <li><code>age</code> ‚Äî <span data-i18n="data.card2.var6">Edad</span></li>
            <li><code>gender</code> ‚Äî <span data-i18n="data.card2.var7">G√©nero</span></li>
            <li><code>trust_score</code> ‚Äî <span data-i18n="data.card2.var8">Puntuaci√≥n de confianza (1-10)</span></li>
          </ul>
        </div>
      </div>
      <div class="card" style="margin-top:16px">
        <h3 data-i18n="data.card3.title">Acceso al dataset completo</h3>
        <p data-i18n="data.card3.text">El dataset completo con datos de los 34 pa√≠ses estar√° disponible tras la publicaci√≥n de los art√≠culos principales. Se alojar√° en repositorios abiertos con DOI y licencia Creative Commons.</p>
        <p class="small" style="margin-top:8px" data-i18n="data.card3.note">Para acceso anticipado o colaboraciones, contacta al <a href="https://www.ub.edu/school-economics/researchers/exadaktylos-filippos/" target="_blank" style="color:#60a5fa; text-decoration:none">equipo de coordinaci√≥n</a>.</p>
      </div>
    </div>
  </section>

  <!-- CUESTIONARIO -->
  <section id="cuestionario">
    <div class="container two-col equal">
      <aside id="questionaries-box" class="card">
        <h3 data-i18n="questionnaire.docsTitle">Questionaries</h3>
        <p class="small">
          <a id="open-qualtrics-btn" class="btn" href="#" rel="noopener" data-i18n="questionnaire.btn1">Abrir Qualtrics (placeholder)</a>
          <a id="download-all-questionnaires" class="btn secondary" href="#" rel="noopener" data-i18n="questionnaire.btn2">Descargar PDF (placeholder)</a>
        </p>
        <div style="max-height: 400px; overflow-y: auto; margin: 16px 0; padding-right: 8px;">
          <a href="data/countries/argentina/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá¶üá∑ Argentina</a>
          <a href="data/countries/austria/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá¶üáπ Austria</a>
          <a href="data/countries/chile/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá®üá± Chile</a>
          <a href="data/countries/china/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá®üá≥ China</a>
          <a href="data/countries/cotedivoire/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá®üáÆ C√¥te d'Ivoire</a>
          <a href="data/countries/congo/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá®üá© D.R. Congo</a>
          <a href="data/countries/colombia/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá®üá¥ Colombia</a>
          <a href="data/countries/czechia/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá®üáø Czech Republic</a>
          <a href="data/countries/germany/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá©üá™ Germany</a>
          <a href="data/countries/egypt/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá™üá¨ Egypt</a>
          <a href="data/countries/spain/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá™üá∏ Spain</a>
          <a href="data/countries/france/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá´üá∑ France</a>
          <a href="data/countries/uk/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá¨üáß United Kingdom</a>
          <a href="data/countries/greece/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá¨üá∑ Greece</a>
          <a href="data/countries/hongkong/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá≠üá∞ Hong Kong</a>
          <a href="data/countries/hungary/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá≠üá∫ Hungary</a>
          <a href="data/countries/italy/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üáÆüáπ Italy</a>
          <a href="data/countries/japan/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üáØüáµ Japan</a>
          <a href="data/countries/kazakhstan/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá∞üáø Kazakhstan</a>
          <a href="data/countries/korea/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá∞üá∑ South Korea</a>
          <a href="data/countries/madagascar/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá≤üá¨ Madagascar</a>
          <a href="data/countries/pakistan/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üáµüá∞ Pakistan</a>
          <a href="data/countries/peru/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üáµüá™ Peru</a>
          <a href="data/countries/philippines/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üáµüá≠ Philippines</a>
          <a href="data/countries/poland/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üáµüá± Poland</a>
          <a href="data/countries/portugal/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üáµüáπ Portugal</a>
          <a href="data/countries/qatar/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá∂üá¶ Qatar</a>
          <a href="data/countries/russia/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá∑üá∫ Russia</a>
          <a href="data/countries/saudi/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá∏üá¶ Saudi Arabia</a>
          <a href="data/countries/singapore/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá∏üá¨ Singapore</a>
          <a href="data/countries/turkey/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üáπüá∑ Turkey</a>
          <a href="data/countries/taiwan/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üáπüáº Taiwan</a>
          <a href="data/countries/uruguay/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá∫üáæ Uruguay</a>
          <a href="data/countries/usa/questionnaire.pdf" download class="btn secondary" style="display: block; margin-bottom: 8px; font-size: 13px; padding: 8px 12px;">üá∫üá∏ United States</a>
        </div>
        <p class="small" data-i18n="questionnaire.docsNote">Descarga cuestionarios por pa√≠s.</p>
      </aside>
      <div id="prereg-box" class="card">
        <h3 data-i18n="prereg.title">Pre‚Äëregistros</h3>
        <p class="small" style="margin-bottom:12px">
          <a id="download-all-prereg" class="btn secondary" href="#" data-i18n="prereg.btnAll">Download all preregistrations</a>
        </p>
        <div style="max-height: 400px; overflow-y: auto; margin: 16px 0; padding-right: 8px;">
          <a href="data/projects/project-01/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 01</a>
          <a href="data/projects/project-02/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 02</a>
          <a href="data/projects/project-03/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 03</a>
          <a href="data/projects/project-04/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 04</a>
          <a href="data/projects/project-05/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 05</a>
          <a href="data/projects/project-06/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 06</a>
          <a href="data/projects/project-07/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 07</a>
          <a href="data/projects/project-08/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 08</a>
          <a href="data/projects/project-09/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 09</a>
          <a href="data/projects/project-10/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 10</a>
          <a href="data/projects/project-11/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 11</a>
          <a href="data/projects/project-12/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 12</a>
          <a href="data/projects/project-13/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 13</a>
          <a href="data/projects/project-14/preregistration.pdf" download class="btn secondary" style="display:block; margin-bottom:8px; font-size:13px; padding:8px 12px;">Project 14</a>
        </div>
      </div>
    </div>
  </section>


  <!-- FOTOS -->
  <section id="fotos">
    <div class="container">
      <h2 data-i18n="photos.title">Fotos</h2>
      <p class="sub" data-i18n="photos.subtitle">Sustituye con im√°genes de aulas, talleres y equipos. (Marcadores de Picsum).</p>
      <div class="gallery" style="margin-top:12px">
        <img src="https://picsum.photos/id/1011/600/400" alt="Aula universitaria 1" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1025/600/400" alt="Actividad en clase 2" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1035/600/400" alt="Vista de campus 3" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1044/600/400" alt="Estudiantes 4" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1050/600/400" alt="Taller 5" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1062/600/400" alt="Seminario 6" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1074/600/400" alt="Equipo de investigaci√≥n 7" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1084/600/400" alt="Encuentro 8" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1080/600/400" alt="Participantes 9" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1015/600/400" alt="Aula universitaria 10" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1016/600/400" alt="Aula universitaria 11" loading="lazy" decoding="async" />
        <img src="https://picsum.photos/id/1019/600/400" alt="Aula universitaria 12" loading="lazy" decoding="async" />
      </div>
    </div>
  </section>
</main>

<!-- FOOTER -->
<footer>
  <div class="container">
    <div class="grid cols-3">
      <div>
        <strong>DICE</strong><br/><span class="small" data-i18n="footer.tagline">Normas & honestidad en 34 pa√≠ses</span>
      </div>
      <div>
        <span class="small" data-i18n="footer.contact">Contacto</span><br/>
        <a href="mailto:dice-experiment@example.org" class="small">dice‚Äëexperiment@example.org</a>
      </div>
      <div>
        <span class="small" data-i18n="footer.status">Estado del sitio</span><br/>
        <span class="small"><span data-i18n="footer.updated">√öltima actualizaci√≥n:</span> <time id="last-updated" aria-live="polite"></time></span>
      </div>
    </div>
  </div>
</footer>

<script>
  // Translations
  const translations = {
    en: {
      nav: {
        subtitle: 'Multicultural classroom experiment',
        welcome: 'Welcome',
        implementation: 'Implementation',
        collaborators: 'Collaborators',
        projects: 'Projects',
        data: 'Data',
        photos: 'Photos',
        questionnaire: 'Questionnaires',
        prereg: 'Pre-registrations'
      },
      hero: {
        title: 'DICE Project',
        subtitle: 'A coordinated and harmonized classroom experiment conducted in <strong>34 countries</strong> to study social norms and honesty. The shared database feeds <strong>14 projects</strong> that analyze complementary mechanisms (civic capital, institutional trust, social preferences, and compliance).',
        chip1: 'In-class',
        chip2: '34 countries',
        chip3: 'Common protocol',
        chip4: 'Open materials',
        chip5: '14 linked projects',
        kpi1: 'Countries',
        kpi2: 'Linked projects',
        kpi3: 'Dataset & protocol'
      },
      countries: {
        title: '34 Participating Countries',
        subtitle: 'Global research network with representation across 5 continents.',
        ARG: 'Argentina', AUT: 'Austria', CHL: 'Chile', CHN: 'China', CIV: 'C√¥te d\'Ivoire',
        COD: 'D.R. Congo', COL: 'Colombia', CZE: 'Czech Republic', DEU: 'Germany', EGY: 'Egypt',
        ESP: 'Spain', FRA: 'France', GBR: 'United Kingdom', GRC: 'Greece', HKG: 'Hong Kong',
        HUN: 'Hungary', ITA: 'Italy', JPN: 'Japan', KAZ: 'Kazakhstan', KOR: 'South Korea',
        MDG: 'Madagascar', PAK: 'Pakistan', PER: 'Peru', PHL: 'Philippines', POL: 'Poland',
        PRT: 'Portugal', QAT: 'Qatar', RUS: 'Russia', SAU: 'Saudi Arabia', SGP: 'Singapore',
        TUR: 'Turkey', TWN: 'Taiwan', URY: 'Uruguay', USA: 'United States',
        legend: 'Participating countries (34)',
        note: 'Coverage across America, Europe, Asia, Africa, and Oceania'
      },
      countryDetails: {
        title: 'Country Teams',
        subtitle: 'Detailed information about each participating research team.',
        team: 'Team:',
        institution: 'Institution:',
        city: 'City:',
        sample: 'Sample:',
        observations: 'Observations:'
      },
      implementation: {
        title: 'Implementation Summary',
        item1: '<strong>Design:</strong> Classroom dice task with harmonized instructions, supervision, and standardized timing.',
        item2: '<strong>Sample:</strong> University classes; target N per country according to protocol (replace with your figures).',
        item3: '<strong>Key measures:</strong> Outcome reporting, honesty proxies, social norms, trust, civic behaviors, and demographics.',
        item4: '<strong>Quality:</strong> Pre-registration, proctor checklist, timestamps, and centralized validation.',
        item5: '<strong>Data:</strong> Phased releases (pilot ‚Üí v1.0 ‚Üí replication) with license and citation guide.',
        quickLinks: 'Quick Links',
        link1: 'Questionnaire preview',
        link2: 'Pre-analysis registry',
        link3: 'Project list',
        link4: 'Replication package (placeholder)',
        note: 'Replace <em>placeholders</em> with links to OSF/AEA/Dataverse/GitHub.'
      },
      collaborators: {
        title: 'Collaborators',
        subtitle: 'Global network of researchers, instructors, and assistants. Add logos, names, roles, and institutions.',
        card1: {
          title: 'Coordination',
          text: 'Principal investigator: <strong><a href="https://www.ub.edu/school-economics/researchers/exadaktylos-filippos/" target="_blank" style="color:inherit; text-decoration:none">Filippos Exadaktylos</a></strong> (example)',
          note: 'Add co-PIs, project management, and contacts.'
        },
        card2: {
          title: 'Country teams',
          text: 'One card per country with institution, PI(s), city, educational level, and sample size.',
          viewall: '‚Üí View all 34 countries'
        },
        card3: {
          title: 'Methods & QA',
          text: 'Protocol authors, survey architecture, and data audit team.',
          tag1: 'Protocol',
          tag2: 'Survey',
          tag3: 'Audit'
        },
        card4: {
          title: 'Partners & funders',
          text: 'Include grant numbers, sponsors, and institutional partnerships.'
        }
      },
      projects: {
        title: 'Projects (14)',
        subtitle: 'Each project leverages a different part of the shared dataset. Below are brief summaries and key links.',
        p1: { title: '1. Social norms & reporting', desc: 'Relationship between perceived norms/meta-beliefs and behavior in the dice task.' },
        p2: { title: '2. Civic capital & trust', desc: 'Civic behaviors, institutional trust, and honesty across cultures.' },
        p3: { title: '3. Compliance & policy', desc: 'Rule acceptance and compliance correlates.' },
        p4: { title: '4. Cultural dimensions', desc: 'Individualism, universalism, and norm-following.' },
        p5: { title: '5. Institutions & honesty', desc: 'Institutional quality and interactions with honesty proxies.' },
        p6: { title: '6. Inequality & justice', desc: 'Distributive preferences and rule compliance.' },
        p7: { title: '7. Education & cohorts', desc: 'Differences by age and educational level.' },
        p8: { title: '8. Urban vs. regional', desc: 'Geography, institution type, and norms.' },
        p9: { title: '9. Gender & norms', desc: 'Gender expectations and honesty.' },
        p10: { title: '10. Replication & methods', desc: 'Power, identification, and robustness across countries.' },
        p11: { title: '11. Messages & beliefs', desc: 'Informational treatments and norm updating.' },
        p12: { title: '12. Networks & spillovers', desc: 'Peer effects in the classroom.' },
        p13: { title: '13. Ethics & consent', desc: 'Ethical approvals and consent language.' },
        p14: { title: '14. Data curation', desc: 'Documentation standardization and versioning.' },
        tag: {
          analysis: 'Analysis plan',
          materials: 'Materials',
          code: 'Code',
          prereg: 'Pre-reg',
          slides: 'Slides',
          design: 'Design',
          results: 'Results',
          guide: 'Guide'
        }
      },
      data: {
        title: 'Data',
        subtitle: 'Access our sample data from the DICE experiment. Full dataset available after publication.',
        card1: {
          title: 'Sample data',
          desc: 'Sample dataset with 15 participants from 5 countries. Includes dice outcomes, demographics, and trust scores.',
          format: 'Format:',
          size: 'Size:',
          updated: 'Updated:',
          btn: 'Download sample data'
        },
        card2: {
          title: 'Data structure',
          desc: 'The dataset includes the following variables:',
          var1: 'Participant country',
          var2: 'Unique ID',
          var3: 'Actual dice roll',
          var4: 'Reported value',
          var5: 'Session date',
          var6: 'Age',
          var7: 'Gender',
          var8: 'Trust score (1-10)'
        },
        card3: {
          title: 'Full dataset access',
          text: 'The complete dataset with data from all 34 countries will be available after publication of the main papers. It will be hosted in open repositories with DOI and Creative Commons license.',
          note: 'For early access or collaborations, contact the <a href="https://www.ub.edu/school-economics/researchers/exadaktylos-filippos/" target="_blank" style="color:#60a5fa; text-decoration:none">coordination team</a>.'
        }
      },
      photos: {
        title: 'Photos',
        subtitle: 'Replace with images of classrooms, workshops, and teams. (Picsum placeholders).'
      },
      questionnaire: {
        title: 'Questionnaire (preview)',
        intro: 'Suggested structure; you can embed Qualtrics or link PDF.',
        item1: '<strong>Dice task module</strong> ‚Äî Instructions, practice, reporting',
        item2: '<strong>Social norms</strong> ‚Äî Descriptive/injunctive and meta-beliefs',
        item3: '<strong>Trust & institutions</strong> ‚Äî Interpersonal, institutional, civic behaviors',
        item4: '<strong>Demographics</strong> ‚Äî Age, gender, education, region',
        item5: '<strong>Country</strong> ‚Äî IRB, translations, timings',
        version: 'Recommended versioning: <code>DICE‚ÄëQ v1.2 (2025‚Äë06‚Äë10)</code>',
        btn1: 'Open Qualtrics (placeholder)',
        btn2: 'Download all Questionaires',
        docsTitle: 'Questionaries',
        docsNote: 'Download questionnaires by country.'
      },
      prereg: {
        title: 'Pre-registrations',
        btnAll: 'Download all preregistrations'
      },
      footer: {
        tagline: 'Norms & honesty in 34 countries',
        contact: 'Contact',
        status: 'Site status',
        updated: 'Last updated:'
      }
    },
    es: {
      nav: {
        subtitle: 'Experimento multicultural en aula',
        welcome: 'Bienvenida',
        implementation: 'Implementaci√≥n',
        collaborators: 'Colaboradores',
        projects: 'Proyectos',
        data: 'Datos',
        photos: 'Fotos',
        questionnaire: 'Cuestionarios',
        prereg: 'Pre‚Äëregistros'
      },
      hero: {
        title: 'Proyecto DICE',
        subtitle: 'Un experimento en aula, coordinado y armonizado, realizado en <strong>34 pa√≠ses</strong> para estudiar normas sociales y honestidad. La base de datos com√∫n alimenta <strong>14 proyectos</strong> que analizan mecanismos complementarios (capital c√≠vico, confianza institucional, preferencias sociales y cumplimiento).',
        chip1: 'En aula',
        chip2: '34 pa√≠ses',
        chip3: 'Protocolo com√∫n',
        chip4: 'Materiales abiertos',
        chip5: '14 proyectos vinculados',
        kpi1: 'Pa√≠ses',
        kpi2: 'Proyectos vinculados',
        kpi3: 'Dataset & protocolo'
      },
      countries: {
        title: '34 Pa√≠ses participantes',
        subtitle: 'Red global de investigaci√≥n con representaci√≥n en 5 continentes.',
        ARG: 'Argentina', AUT: 'Austria', CHL: 'Chile', CHN: 'China', CIV: 'C√¥te d\'Ivoire',
        COD: 'R.D. del Congo', COL: 'Colombia', CZE: 'Rep√∫blica Checa', DEU: 'Alemania', EGY: 'Egipto',
        ESP: 'Espa√±a', FRA: 'Francia', GBR: 'Reino Unido', GRC: 'Grecia', HKG: 'Hong Kong',
        HUN: 'Hungr√≠a', ITA: 'Italia', JPN: 'Jap√≥n', KAZ: 'Kazajist√°n', KOR: 'Corea del Sur',
        MDG: 'Madagascar', PAK: 'Pakist√°n', PER: 'Per√∫', PHL: 'Filipinas', POL: 'Polonia',
        PRT: 'Portugal', QAT: 'Catar', RUS: 'Rusia', SAU: 'Arabia Saudita', SGP: 'Singapur',
        TUR: 'Turqu√≠a', TWN: 'Taiw√°n', URY: 'Uruguay', USA: 'Estados Unidos',
        legend: 'Pa√≠ses participantes (34)',
        note: 'Cobertura en Am√©rica, Europa, Asia, √Åfrica y Ocean√≠a'
      },
      countryDetails: {
        title: 'Equipos por pa√≠s',
        subtitle: 'Informaci√≥n detallada de cada equipo de investigaci√≥n participante.',
        team: 'Equipo:',
        institution: 'Instituci√≥n:',
        city: 'Ciudad:',
        sample: 'Muestra:',
        observations: 'Observaciones:'
      },
      implementation: {
        title: 'Resumen de implementaci√≥n',
        item1: '<strong>Dise√±o:</strong> Tarea del dado en aula con instrucciones armonizadas, supervisi√≥n y tiempos estandarizados.',
        item2: '<strong>Muestra:</strong> Clases universitarias; N objetivo por pa√≠s seg√∫n protocolo (sustituir con tus cifras).',
        item3: '<strong>Medidas clave:</strong> Reporte de resultados, proxies de honestidad, normas sociales, confianza, conductas c√≠vicas y demograf√≠a.',
        item4: '<strong>Calidad:</strong> Pre‚Äëregistro, checklist de proctor, marcas de tiempo y validaci√≥n centralizada.',
        item5: '<strong>Datos:</strong> Liberaciones por etapas (piloto ‚Üí v1.0 ‚Üí replicaci√≥n) con gu√≠a de licencia y citaci√≥n.',
        quickLinks: 'Accesos r√°pidos',
        link1: 'Vista previa del cuestionario',
        link2: 'Registro de pre‚Äëan√°lisis',
        link3: 'Listado de proyectos',
        link4: 'Paquete de replicaci√≥n (placeholder)',
        note: 'Sustituye los <em>placeholders</em> por enlaces a OSF/AEA/Dataverse/GitHub.'
      },
      collaborators: {
        title: 'Colaboradores',
        subtitle: 'Red global de investigadores/as, docentes y asistentes. A√±ade logotipos, nombres, roles e instituciones.',
        card1: {
          title: 'Coordinaci√≥n',
          text: 'Investigador principal: <strong><a href="https://www.ub.edu/school-economics/researchers/exadaktylos-filippos/" target="_blank" style="color:inherit; text-decoration:none">Filippos Exadaktylos</a></strong> (ejemplo)',
          note: 'A√±ade co‚ÄëIPs, gesti√≥n de proyecto y contactos.'
        },
        card2: {
          title: 'Equipos por pa√≠s',
          text: 'Una tarjeta por pa√≠s con instituci√≥n, PI(s), ciudad, nivel educativo y tama√±o muestral.',
          viewall: '‚Üí Ver todos los 34 pa√≠ses'
        },
        card3: {
          title: 'M√©todos & QA',
          text: 'Autores del protocolo, arquitectura de encuesta y equipo de auditor√≠a de datos.',
          tag1: 'Protocolo',
          tag2: 'Encuesta',
          tag3: 'Auditor√≠a'
        },
        card4: {
          title: 'Socios & financiadores',
          text: 'Incluye n√∫meros de beca, patrocinadores y alianzas institucionales.'
        }
      },
      projects: {
        title: 'Proyectos (14)',
        subtitle: 'Cada proyecto aprovecha una parte distinta del dataset com√∫n. A continuaci√≥n, res√∫menes breves y enlaces clave.',
        p1: { title: '1. Normas sociales & reporte', desc: 'Relaci√≥n entre normas percibidas/metacreencias y conducta en la tarea del dado.' },
        p2: { title: '2. Capital c√≠vico & confianza', desc: 'Conductas c√≠vicas, confianza institucional y honestidad entre culturas.' },
        p3: { title: '3. Cumplimiento & pol√≠tica', desc: 'Aceptaci√≥n de reglas y correlatos de cumplimiento.' },
        p4: { title: '4. Dimensiones culturales', desc: 'Individualismo, universalismo y seguimiento de normas.' },
        p5: { title: '5. Instituciones & honestidad', desc: 'Calidad institucional e interacciones con proxies de honestidad.' },
        p6: { title: '6. Desigualdad & justicia', desc: 'Preferencias distributivas y cumplimiento de reglas.' },
        p7: { title: '7. Educaci√≥n & cohortes', desc: 'Diferencias por edad y nivel educativo.' },
        p8: { title: '8. Urbano vs. regional', desc: 'Geograf√≠a, tipo de centro y normas.' },
        p9: { title: '9. G√©nero & normas', desc: 'Expectativas de g√©nero y honestidad.' },
        p10: { title: '10. Replicaci√≥n & m√©todos', desc: 'Potencia, identificaci√≥n y robustez entre pa√≠ses.' },
        p11: { title: '11. Mensajes & creencias', desc: 'Tratamientos informativos y actualizaci√≥n de normas.' },
        p12: { title: '12. Redes & spillovers', desc: 'Efectos de pares en el aula.' },
        p13: { title: '13. √âtica & consentimiento', desc: 'Aprobaciones √©ticas y lenguaje de consentimiento.' },
        p14: { title: '14. Curaci√≥n de datos', desc: 'Estandarizaci√≥n documental y versionado.' },
        tag: {
          analysis: 'Plan de an√°lisis',
          materials: 'Materiales',
          code: 'C√≥digo',
          prereg: 'Pre‚Äëreg',
          slides: 'Diapositivas',
          design: 'Dise√±o',
          results: 'Resultados',
          guide: 'Gu√≠a'
        }
      },
      data: {
        title: 'Datos',
        subtitle: 'Accede a nuestros datos de muestra del experimento DICE. Datos completos disponibles tras publicaci√≥n.',
        card1: {
          title: 'Datos de muestra',
          desc: 'Dataset de ejemplo con 15 participantes de 5 pa√≠ses. Incluye resultados del dado, datos demogr√°ficos y puntuaciones de confianza.',
          format: 'Formato:',
          size: 'Tama√±o:',
          updated: 'Actualizado:',
          btn: 'Descargar datos de muestra'
        },
        card2: {
          title: 'Estructura de datos',
          desc: 'El dataset incluye las siguientes variables:',
          var1: 'Pa√≠s del participante',
          var2: 'ID √∫nico',
          var3: 'Resultado real del dado',
          var4: 'Valor reportado',
          var5: 'Fecha de sesi√≥n',
          var6: 'Edad',
          var7: 'G√©nero',
          var8: 'Puntuaci√≥n de confianza (1-10)'
        },
        card3: {
          title: 'Acceso al dataset completo',
          text: 'El dataset completo con datos de los 34 pa√≠ses estar√° disponible tras la publicaci√≥n de los art√≠culos principales. Se alojar√° en repositorios abiertos con DOI y licencia Creative Commons.',
          note: 'Para acceso anticipado o colaboraciones, contacta al <a href="https://www.ub.edu/school-economics/researchers/exadaktylos-filippos/" target="_blank" style="color:#60a5fa; text-decoration:none">equipo de coordinaci√≥n</a>.'
        }
      },
      photos: {
        title: 'Fotos',
        subtitle: 'Sustituye con im√°genes de aulas, talleres y equipos. (Marcadores de Picsum).'
      },
      questionnaire: {
        title: 'Cuestionario (vista previa)',
        intro: 'Estructura sugerida; puedes incrustar Qualtrics o enlazar PDF.',
        item1: '<strong>M√≥dulo tarea del dado</strong> ‚Äî Instrucciones, pr√°ctica, reporte',
        item2: '<strong>Normas sociales</strong> ‚Äî Descriptivas/injuntivas y metacreencias',
        item3: '<strong>Confianza & instituciones</strong> ‚Äî Interpersonal, institucional, conductas c√≠vicas',
        item4: '<strong>Demograf√≠a</strong> ‚Äî Edad, g√©nero, estudios, regi√≥n',
        item5: '<strong>Pa√≠s</strong> ‚Äî IRB, traducciones, tiempos',
        version: 'Versionado recomendado: <code>DICE‚ÄëQ v1.2 (2025‚Äë06‚Äë10)</code>',
        btn1: 'Abrir Qualtrics (placeholder)',
        btn2: 'Download all Questionaires',
        docsTitle: 'Questionaries',
        docsNote: 'Descarga cuestionarios por pa√≠s.'
      },
      prereg: {
        title: 'Pre‚Äëregistros',
        btnAll: 'Descargar todos los pre‚Äëregistros'
      },
      footer: {
        tagline: 'Normas & honestidad en 34 pa√≠ses',
        contact: 'Contacto',
        status: 'Estado del sitio',
        updated: '√öltima actualizaci√≥n:'
      }
    }
  };

  // Update prereg list labels to actual project names (by language)
  function updatePreregLabels(){
    try {
      const lang = currentLang || (localStorage.getItem('lang') || 'es');
      const base = translations && translations[lang] && translations[lang].projects;
      if (!base) return;
      document.querySelectorAll('#prereg-box a.btn.secondary[href$="preregistration.pdf"]').forEach(a => {
        const href = a.getAttribute('href') || '';
        const m = href.match(/project-(\d+)/);
        if (!m) return;
        const idx = parseInt(m[1], 10);
        const key = 'p' + idx;
        const title = base[key] && base[key].title ? String(base[key].title) : '';
        const pretty = title.replace(/^\s*\d+\.\s*/, '').trim();
        if (pretty) a.textContent = pretty;
      });
    } catch (e) {
      console.warn('updatePreregLabels failed', e);
    }
  }

  // Language switcher
  let currentLang = localStorage.getItem('lang') || 'es';

  function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('lang', lang);
    document.documentElement.setAttribute('lang', lang);

    // Update all elements with data-i18n
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      const keys = key.split('.');
      let value = translations[lang];
      keys.forEach(k => value = value[k]);
      if (value) el.innerHTML = value;
    });

    // Update nav links
    document.querySelectorAll('[data-i18n-nav]').forEach(el => {
      const key = el.getAttribute('data-i18n-nav');
      const value = translations[lang].nav[key];
      if (value) el.textContent = value;
    });

    // Update active language button
    document.querySelectorAll('.lang-option').forEach(opt => {
      opt.classList.toggle('active', opt.getAttribute('data-lang') === lang);
    });

    // Refresh preregistration labels to current language
    updatePreregLabels();
  }

  // Initialize language on page load
  document.addEventListener('DOMContentLoaded', () => {
    setLanguage(currentLang);

    // Language toggle click handler
    document.querySelectorAll('.lang-option').forEach(opt => {
      opt.addEventListener('click', () => {
        setLanguage(opt.getAttribute('data-lang'));
      });
    });

    // Initial prereg label hydration
    updatePreregLabels();
  });

  // Last updated stamp
  document.getElementById('last-updated').textContent = new Date().toISOString().slice(0,10);

  // Toast helper
  window.showToast = function(message){
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = '‚úì ' + message;
    document.body.appendChild(toast);
    requestAnimationFrame(() => toast.classList.add('show'));
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 200);
    }, 3000);
  };
</script>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<!-- Zip libraries for bundling questionnaires -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
  // Initialize map
  const map = L.map('map', {
    center: [30, 0],
    zoom: 2,
    minZoom: 1,
    maxZoom: 6,
    scrollWheelZoom: false,
    zoomControl: true
  });

  // Add a base tile layer so the map is visible even if GeoJSON fails
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright" rel="noopener" target="_blank">OpenStreetMap</a> contributors',
    maxZoom: 19
  }).addTo(map);

  // Ensure proper sizing after load
  window.addEventListener('load', () => setTimeout(() => map.invalidateSize(), 0));

  // ISO3 codes for participating countries
  const participatingCountryCodes = [
    'ARG', 'AUT', 'CHL', 'CHN', 'CIV', 'COD', 'COL', 'CZE', 'DEU', 'EGY',
    'ESP', 'FRA', 'GBR', 'GRC', 'HKG', 'HUN', 'ITA', 'JPN', 'KAZ', 'KOR',
    'MDG', 'PAK', 'PER', 'PHL', 'POL', 'PRT', 'QAT', 'RUS', 'SAU', 'SGP',
    'TUR', 'TWN', 'URY', 'USA'
  ];

  // Country data with details and flags
  const countryData = {
    'ARG': { anchor: 'argentina', flag: 'üá¶üá∑', name: 'Argentina', team: 'Dr. Mar√≠a Gonz√°lez, Prof. Juan P√©rez', institution: 'Universidad de Buenos Aires', sample: 'N = 450' },
    'AUT': { anchor: 'austria', flag: 'üá¶üáπ', name: 'Austria', team: 'Dr. Klaus Weber', institution: 'University of Vienna', sample: 'N = 380' },
    'CHL': { anchor: 'chile', flag: 'üá®üá±', name: 'Chile', team: 'Dr. Carmen Silva, Dr. Roberto Mu√±oz', institution: 'Universidad de Chile', sample: 'N = 425' },
    'CHN': { anchor: 'china', flag: 'üá®üá≥', name: 'China', team: 'Prof. Wei Zhang, Dr. Li Wang', institution: 'Peking University', sample: 'N = 520' },
    'CIV': { anchor: 'cotedivoire', flag: 'üá®üáÆ', name: 'C√¥te d\'Ivoire', team: 'Dr. Amara Kon√©', institution: 'Universit√© F√©lix Houphou√´t-Boigny', sample: 'N = 340' },
    'COD': { anchor: 'congo', flag: 'üá®üá©', name: 'D.R. Congo', team: 'Prof. Joseph Kabila', institution: 'Universit√© de Kinshasa', sample: 'N = 310' },
    'COL': { anchor: 'colombia', flag: 'üá®üá¥', name: 'Colombia', team: 'Dr. Ana Rodr√≠guez, Prof. Carlos Mart√≠nez', institution: 'Universidad de los Andes', sample: 'N = 480' },
    'CZE': { anchor: 'czechia', flag: 'üá®üáø', name: 'Czech Republic', team: 'Dr. Jan Nov√°k', institution: 'Charles University', sample: 'N = 390' },
    'DEU': { anchor: 'germany', flag: 'üá©üá™', name: 'Germany', team: 'Prof. Hans Schmidt, Dr. Anna M√ºller', institution: 'University of Munich', sample: 'N = 510' },
    'EGY': { anchor: 'egypt', flag: 'üá™üá¨', name: 'Egypt', team: 'Dr. Ahmed Hassan', institution: 'Cairo University', sample: 'N = 370' },
    'ESP': { anchor: 'spain', flag: 'üá™üá∏', name: 'Spain', team: '<a href="https://www.ub.edu/school-economics/researchers/exadaktylos-filippos/" target="_blank" style="color:#60a5fa; text-decoration:none">Dr. Filippos Exadaktylos</a>, Dr. Laura S√°nchez', institution: 'Universidad de Granada', sample: 'N = 465' },
    'FRA': { anchor: 'france', flag: 'üá´üá∑', name: 'France', team: 'Prof. Marie Dubois, Dr. Pierre Martin', institution: 'Sorbonne University', sample: 'N = 440' },
    'GBR': { anchor: 'uk', flag: 'üá¨üáß', name: 'United Kingdom', team: 'Dr. James Wilson, Prof. Emma Taylor', institution: 'University of Oxford', sample: 'N = 490' },
    'GRC': { anchor: 'greece', flag: 'üá¨üá∑', name: 'Greece', team: 'Dr. Nikos Papadopoulos', institution: 'Athens University of Economics', sample: 'N = 360' },
    'HKG': { anchor: 'hongkong', flag: 'üá≠üá∞', name: 'Hong Kong', team: 'Dr. Michael Chan', institution: 'University of Hong Kong', sample: 'N = 405' },
    'HUN': { anchor: 'hungary', flag: 'üá≠üá∫', name: 'Hungary', team: 'Dr. Istv√°n Nagy', institution: 'Corvinus University', sample: 'N = 375' },
    'ITA': { anchor: 'italy', flag: 'üáÆüáπ', name: 'Italy', team: 'Prof. Giovanni Rossi, Dr. Francesca Bianchi', institution: 'Bocconi University', sample: 'N = 475' },
    'JPN': { anchor: 'japan', flag: 'üáØüáµ', name: 'Japan', team: 'Prof. Takashi Yamamoto', institution: 'University of Tokyo', sample: 'N = 500' },
    'KAZ': { anchor: 'kazakhstan', flag: 'üá∞üáø', name: 'Kazakhstan', team: 'Dr. Assel Nurgaliyeva', institution: 'Nazarbayev University', sample: 'N = 330' },
    'KOR': { anchor: 'korea', flag: 'üá∞üá∑', name: 'South Korea', team: 'Prof. Ji-Hoon Kim, Dr. Min-Jung Lee', institution: 'Seoul National University', sample: 'N = 485' },
    'MDG': { anchor: 'madagascar', flag: 'üá≤üá¨', name: 'Madagascar', team: 'Dr. Hery Rasolofonirina', institution: 'University of Antananarivo', sample: 'N = 290' },
    'PAK': { anchor: 'pakistan', flag: 'üáµüá∞', name: 'Pakistan', team: 'Dr. Fatima Khan', institution: 'Lahore University of Management Sciences', sample: 'N = 410' },
    'PER': { anchor: 'peru', flag: 'üáµüá™', name: 'Peru', team: 'Dr. Miguel Vargas', institution: 'Pontificia Universidad Cat√≥lica del Per√∫', sample: 'N = 395' },
    'PHL': { anchor: 'philippines', flag: 'üáµüá≠', name: 'Philippines', team: 'Dr. Maria Santos', institution: 'University of the Philippines', sample: 'N = 385' },
    'POL': { anchor: 'poland', flag: 'üáµüá±', name: 'Poland', team: 'Dr. Anna Kowalski', institution: 'University of Warsaw', sample: 'N = 420' },
    'PRT': { anchor: 'portugal', flag: 'üáµüáπ', name: 'Portugal', team: 'Dr. Jo√£o Silva', institution: 'Universidade de Lisboa', sample: 'N = 365' },
    'QAT': { anchor: 'qatar', flag: 'üá∂üá¶', name: 'Qatar', team: 'Dr. Abdullah Al-Thani', institution: 'Qatar University', sample: 'N = 320' },
    'RUS': { anchor: 'russia', flag: 'üá∑üá∫', name: 'Russia', team: 'Prof. Dmitry Ivanov', institution: 'Moscow State University', sample: 'N = 460' },
    'SAU': { anchor: 'saudi', flag: 'üá∏üá¶', name: 'Saudi Arabia', team: 'Dr. Mohammed Al-Rashid', institution: 'King Saud University', sample: 'N = 355' },
    'SGP': { anchor: 'singapore', flag: 'üá∏üá¨', name: 'Singapore', team: 'Dr. Sarah Tan', institution: 'National University of Singapore', sample: 'N = 430' },
    'TUR': { anchor: 'turkey', flag: 'üáπüá∑', name: 'Turkey', team: 'Dr. Ay≈üe Yƒ±lmaz', institution: 'Boƒüazi√ßi University', sample: 'N = 445' },
    'TWN': { anchor: 'taiwan', flag: 'üáπüáº', name: 'Taiwan', team: 'Prof. Chen Wei', institution: 'National Taiwan University', sample: 'N = 455' },
    'URY': { anchor: 'uruguay', flag: 'üá∫üáæ', name: 'Uruguay', team: 'Dr. Sof√≠a Fern√°ndez', institution: 'Universidad de la Rep√∫blica', sample: 'N = 335' },
    'USA': { anchor: 'usa', flag: 'üá∫üá∏', name: 'United States', team: 'Prof. Robert Johnson, Dr. Jennifer Smith', institution: 'Harvard University', sample: 'N = 505' }
  };

  // Load world countries GeoJSON from a CDN with permissive CORS
  fetch('https://unpkg.com/geojson-world@1.2.0/countries.geo.json')
    .then(response => {
      console.log('Fetch response:', response);
      return response.json();
    })
    .then(data => {
      console.log('GeoJSON loaded, features:', data.features.length);
      console.log('First feature properties:', data.features[0].properties);

      L.geoJSON(data, {
        style: function(feature) {
          const props = feature && feature.properties ? feature.properties : {};
          const countryName = props.name || props.ADMIN || props.admin || '';
          const countryCode = props['ISO3166-1-Alpha-3'] || props.ISO_A3 || props.iso_a3 || props.ADM0_A3 || feature.id;

          const isParticipating = participatingCountryCodes.includes(countryCode);

          if (isParticipating) {
            console.log('Highlighting:', countryName, countryCode);
          }

          return {
            fillColor: isParticipating ? '#4a7ba7' : '#2d3748',
            weight: 0.5,
            opacity: 1,
            color: '#4a5568',
            fillOpacity: isParticipating ? 0.6 : 0.2
          };
        },
        onEachFeature: function(feature, layer) {
          const props = feature && feature.properties ? feature.properties : {};
          const countryCode = props['ISO3166-1-Alpha-3'] || props.ISO_A3 || props.iso_a3 || props.ADM0_A3 || feature.id;
          const isParticipating = participatingCountryCodes.includes(countryCode);

          if (isParticipating) {
            const country = countryData[countryCode];

            // Bind tooltip that shows on hover with full details
            const tooltipContent = `
              <div style="min-width:250px">
                <div style="font-size:18px; margin-bottom:6px">${country.flag} <strong>${country.name}</strong></div>
                <div style="font-size:11px; color:#94a3b8; margin-bottom:4px">Team:</div>
                <div style="font-size:12px; margin-bottom:6px">${country.team}</div>
                <div style="font-size:11px; color:#94a3b8; margin-bottom:4px">Institution:</div>
                <div style="font-size:12px; margin-bottom:6px">${country.institution}</div>
                <div style="font-size:11px; color:#60a5fa">${country.sample} ‚Ä¢ Click for details</div>
              </div>
            `;

            layer.bindTooltip(tooltipContent, {
              permanent: false,
              direction: 'top',
              className: 'country-tooltip',
              opacity: 0.95,
              offset: [0, -10]
            });

            // Add click handler to navigate to countries.html page
            layer.on('click', function(e) {
              if (country.anchor) {
                // Navigate immediately without adding highlight
                window.location.href = `countries.html#${country.anchor}`;
              }
            });

            // Add hover effect and cursor pointer
            layer.on({
              mouseover: function(e) {
                const layer = e.target;
                layer.setStyle({
                  fillOpacity: 0.8,
                  fillColor: '#5a8fc7',
                  cursor: 'pointer'
                });
              },
              mouseout: function(e) {
                const layer = e.target;
                layer.setStyle({
                  fillOpacity: 0.6,
                  fillColor: '#4a7ba7'
                });
              }
            });
          }
        }
      }).addTo(map);

      console.log('Map loaded successfully');
    })
    .catch(error => {
      console.error('Error loading countries:', error);
      const el = document.getElementById('map');
      if (el) {
        const msg = document.createElement('div');
        msg.style.cssText = 'position:absolute; top:10px; left:10px; background:rgba(0,0,0,.6); color:#fff; padding:8px 10px; border-radius:8px; font-size:12px; z-index:5;';
        msg.textContent = 'Error loading country shapes';
        el.appendChild(msg);
      }
    });
</script>

<script>
  // Download all questionnaires as a zip
  document.addEventListener('DOMContentLoaded', () => {
    const downloadBtn = document.getElementById('download-all-questionnaires');
    if (!downloadBtn) return;

    downloadBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      try {
        if (typeof JSZip === 'undefined') {
          alert('Zip library not loaded. Please try again.');
          return;
        }

        const box = document.getElementById('questionaries-box');
        const links = box ? Array.from(box.querySelectorAll('a.btn.secondary[href$="questionnaire.pdf"]')) : [];
        if (links.length === 0) {
          alert('No questionnaires found to download.');
          return;
        }

        downloadBtn.textContent = 'Preparing zip‚Ä¶';
        downloadBtn.setAttribute('aria-busy', 'true');
        downloadBtn.disabled = true;

        const zip = new JSZip();
        const folder = zip.folder('questionnaires');

        const toSafeName = (label) => (label || '')
          .replace(/^[^\p{L}\p{N}]+|[^\p{L}\p{N}]+$/gu, '')
          .replace(/[^\p{L}\p{N}]+/gu, ' ')
          .trim();

        const toFilename = (href) => {
          try {
            const url = new URL(href, window.location.href);
            const parts = url.pathname.split('/').filter(Boolean);
            const country = parts[parts.indexOf('countries') + 1] || 'country';
            return country + '.pdf';
          } catch {
            return 'questionnaire.pdf';
          }
        };

        for (const a of links) {
          const href = a.getAttribute('href');
          const label = toSafeName((a.textContent || '').trim());
          const filename = (label ? label + ' - questionnaire.pdf' : toFilename(href));
          try {
            const resp = await fetch(href);
            if (!resp.ok) throw new Error('HTTP ' + resp.status);
            const blob = await resp.blob();
            const arrayBuffer = await blob.arrayBuffer();
            folder.file(filename, arrayBuffer);
          } catch (err) {
            console.warn('Skipping', href, err);
          }
        }

        const content = await zip.generateAsync({ type: 'blob' });
        if (typeof saveAs !== 'undefined') {
          saveAs(content, 'DICE-questionnaires.zip');
          if (typeof showToast === 'function') showToast('You successfully downloaded questionnaire for all countries');
        } else {
          // Fallback
          const url = URL.createObjectURL(content);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'DICE-questionnaires.zip';
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
          if (typeof showToast === 'function') showToast('You successfully downloaded questionnaire for all countries');
        }
      } catch (err) {
        console.error(err);
        alert('There was an error creating the zip. Please try again.');
      } finally {
        downloadBtn.removeAttribute('aria-busy');
        downloadBtn.disabled = false;
        // Restore i18n label if available, else keep text
        const lang = (window.localStorage && localStorage.getItem('lang')) || 'es';
        const t = (window.translations && translations[lang] && translations[lang].questionnaire && translations[lang].questionnaire.btn2) || 'Download all Questionaires';
        downloadBtn.textContent = t;
      }
    });
  });
</script>

<script>
  // Download all preregistrations as a zip
  document.addEventListener('DOMContentLoaded', () => {
    const downloadBtn = document.getElementById('download-all-prereg');
    if (!downloadBtn) return;

    downloadBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      try {
        if (typeof JSZip === 'undefined') {
          alert('Zip library not loaded. Please try again.');
          return;
        }

        const box = document.getElementById('prereg-box');
        const links = box ? Array.from(box.querySelectorAll('a.btn.secondary[href$="preregistration.pdf"]')) : [];
        if (links.length === 0) {
          alert('No preregistration files found to download.');
          return;
        }

        const originalText = downloadBtn.textContent;
        downloadBtn.textContent = 'Preparing zip‚Ä¶';
        downloadBtn.setAttribute('aria-busy', 'true');
        downloadBtn.disabled = true;

        const zip = new JSZip();
        const folder = zip.folder('preregistrations');

        const toSafeName = (label) => (label || '')
          .replace(/^[^\p{L}\p{N}]+|[^\p{L}\p{N}]+$/gu, '')
          .replace(/[^\p{L}\p{N}]+/gu, ' ')
          .trim();

        const toFilename = (href) => {
          try {
            const url = new URL(href, window.location.href);
            const parts = url.pathname.split('/').filter(Boolean);
            const proj = parts[parts.indexOf('projects') + 1] || 'project';
            return proj + '.pdf';
          } catch {
            return 'preregistration.pdf';
          }
        };

        for (const a of links) {
          const href = a.getAttribute('href');
          const label = toSafeName((a.textContent || '').trim());
          const filename = (label ? label + ' - preregistration.pdf' : toFilename(href));
          try {
            const resp = await fetch(href);
            if (!resp.ok) throw new Error('HTTP ' + resp.status);
            const blob = await resp.blob();
            const arrayBuffer = await blob.arrayBuffer();
            folder.file(filename, arrayBuffer);
          } catch (err) {
            console.warn('Skipping', href, err);
          }
        }

        const content = await zip.generateAsync({ type: 'blob' });
        if (typeof saveAs !== 'undefined') {
          saveAs(content, 'DICE-preregistrations.zip');
          if (typeof showToast === 'function') showToast('You successfully downloaded preregistration for all projects');
        } else {
          const url = URL.createObjectURL(content);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'DICE-preregistrations.zip';
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
          if (typeof showToast === 'function') showToast('You successfully downloaded preregistration for all projects');
        }
      } catch (err) {
        console.error(err);
        alert('There was an error creating the zip. Please try again.');
      } finally {
        downloadBtn.removeAttribute('aria-busy');
        downloadBtn.disabled = false;
        const lang = (window.localStorage && localStorage.getItem('lang')) || 'es';
        const fallback = 'Download all preregistrations';
        const t = (window.translations && translations[lang] && translations[lang].prereg && translations[lang].prereg.btnAll) || fallback;
        downloadBtn.textContent = t;
      }
    });
  });
</script>

<script>
  // Intercept individual downloads to show success toast after fetch+save
  document.addEventListener('DOMContentLoaded', () => {
    function handleDirectDownloads(selector, typeLabel){
      document.querySelectorAll(selector).forEach(a => {
        a.addEventListener('click', async (e) => {
          e.preventDefault();
          const href = a.getAttribute('href');
          const label = (a.textContent || '').trim();
          try {
            const resp = await fetch(href);
            if (!resp.ok) throw new Error('HTTP ' + resp.status);
            const blob = await resp.blob();
            const rawLabel = (label || '').replace(/^[^\p{L}\p{N}]+|[^\p{L}\p{N}]+$/gu, '').replace(/[^\p{L}\p{N}]+/gu, ' ').trim();
            const filename = (rawLabel ? `${rawLabel} - ${typeLabel}.pdf` : (href.split('/').pop() || 'download.pdf'));
            if (typeof saveAs !== 'undefined') {
              saveAs(blob, filename);
            } else {
              const url = URL.createObjectURL(blob);
              const link = document.createElement('a');
              link.href = url;
              link.download = filename;
              document.body.appendChild(link);
              link.click();
              link.remove();
              URL.revokeObjectURL(url);
            }
            if (typeof showToast === 'function') showToast(`You successfully downloaded ${typeLabel} for ${label}`);
          } catch (err) {
            console.error('Download failed:', href, err);
            alert('Failed to download. Please try again.');
          }
        });
      });
    }

    handleDirectDownloads('#questionaries-box a.btn.secondary[href$="questionnaire.pdf"]', 'questionnaire');
    handleDirectDownloads('#prereg-box a.btn.secondary[href$="preregistration.pdf"]', 'preregistration');
  });
</script>
</body>
</html>
